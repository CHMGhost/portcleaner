<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Port Cleaner - What is running!</title>
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline';">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="app-header">
      <div class="header-brand">
        <h1 class="app-title">PortCleaner</h1>
        <p class="app-subtitle">See and free busy ports safely.</p>
      </div>
      <button id="themeToggle" class="theme-toggle" title="Toggle theme (T)" aria-label="Toggle theme">
        <svg class="theme-icon theme-icon-light" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="5"></circle>
          <line x1="12" y1="1" x2="12" y2="3"></line>
          <line x1="12" y1="21" x2="12" y2="23"></line>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
          <line x1="1" y1="12" x2="3" y2="12"></line>
          <line x1="21" y1="12" x2="23" y2="12"></line>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
        <svg class="theme-icon theme-icon-dark hidden" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
        </svg>
      </button>
    </header>
    
    <!-- Primary Controls Row -->
    <div class="primary-controls">
      <div class="free-port-control">
        <input 
          type="number" 
          id="freePortInput" 
          class="primary-input" 
          placeholder="Enter port (1-65535)" 
          min="1" 
          max="65535"
          aria-label="Port number to free"
          autofocus>
        <button id="freePortBtn" class="btn-primary" aria-label="Free port">
          <svg class="btn-icon-svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="15" y1="9" x2="9" y2="15"></line>
            <line x1="9" y1="9" x2="15" y2="15"></line>
          </svg>
          <span class="btn-text">Free Port</span>
          <span class="spinner" style="display: none;"></span>
        </button>
      </div>
      <button id="getAllPortsBtn" class="btn-secondary" aria-label="Show all active ports">
        <svg class="btn-icon-svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="3" y1="9" x2="21" y2="9"></line>
          <line x1="8" y1="14" x2="16" y2="14"></line>
        </svg>
        <span class="btn-text">Show all active ports</span>
        <span class="btn-badge" id="portCountBadge" style="display: none;">0</span>
      </button>
    </div>
    
    <!-- Status/Feedback Row -->
    <div class="status-row" id="statusRow">
      <!-- Error/Warning Banner -->
      <div id="errorBanner" class="inline-banner error-banner hidden">
        <svg class="banner-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
        </svg>
        <div class="banner-content">
          <span class="banner-message"></span>
        </div>
        <button class="banner-dismiss" aria-label="Dismiss">×</button>
      </div>
      
      <!-- Meta Information -->
      <div class="meta-info">
        <span class="meta-item">
          Active: <strong id="activePortCount">0</strong>
        </span>
        <span class="meta-separator">•</span>
        <span class="meta-item">
          Last refreshed: <strong id="lastRefreshTime">Never</strong>
        </span>
        <span class="meta-separator">•</span>
        <span class="meta-item">
          Auto-refresh: 
          <label class="inline-toggle">
            <input type="checkbox" id="autoRefreshToggle" checked>
            <span class="toggle-mini"></span>
          </label>
          <select id="refreshInterval" class="inline-select">
            <option value="1000">1s</option>
            <option value="2000">2s</option>
            <option value="5000" selected>5s</option>
            <option value="10000">10s</option>
            <option value="30000">30s</option>
          </select>
        </span>
      </div>
    </div>
    
    <!-- Table Section -->
    <div class="table-section" id="tableSection" style="display: none;">
      
      <!-- Filters and Search -->
      <div class="filter-bar">
        <div class="search-container">
          <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="5"></circle>
            <line x1="15" y1="15" x2="21" y2="21"></line>
          </svg>
          <input 
            type="text" 
            id="searchInput" 
            class="search-input" 
            placeholder="Search ports, processes, PIDs..."
            aria-label="Search ports">
          <button id="clearSearchBtn" class="clear-search-btn hidden" aria-label="Clear search">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
        <div class="filter-chips">
          <button class="filter-chip active" data-filter="all">All</button>
          <button class="filter-chip" data-filter="favorites">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
            </svg>
            Favorites
          </button>
          <button class="filter-chip" data-filter="critical">Critical ports</button>
          <button class="filter-chip" data-filter="protected">Protected</button>
        </div>
      </div>
      
      <!-- Ports Table -->
      <div class="table-container">
        <table id="portsTable" class="ports-table">
          <thead class="sticky-header">
            <tr>
              <th class="sortable resizable col-port" data-sort="port" data-col="port" style="width: 80px;">
                <span class="th-content">
                  <span class="th-text">Port</span>
                  <span class="sort-indicator">⇅</span>
                </span>
                <div class="resize-handle"></div>
              </th>
              <th class="sortable resizable col-pid" data-sort="pid" data-col="pid" style="width: 100px;">
                <span class="th-content">
                  <span class="th-text">PID</span>
                  <span class="sort-indicator">⇅</span>
                </span>
                <div class="resize-handle"></div>
              </th>
              <th class="sortable resizable col-cpu" data-sort="cpu" data-col="cpu" style="width: 80px;">
                <span class="th-content">
                  <span class="th-text">CPU</span>
                  <span class="sort-indicator">⇅</span>
                </span>
                <div class="resize-handle"></div>
              </th>
              <th class="sortable resizable col-memory" data-sort="memory" data-col="memory" style="width: 120px;">
                <span class="th-content">
                  <span class="th-text">Memory</span>
                  <span class="sort-indicator">⇅</span>
                </span>
                <div class="resize-handle"></div>
              </th>
              <th class="sortable resizable col-user" data-sort="user" data-col="user" style="width: 150px;">
                <span class="th-content">
                  <span class="th-text">User</span>
                  <span class="sort-indicator">⇅</span>
                </span>
                <div class="resize-handle"></div>
              </th>
              <th class="sortable resizable col-process" data-sort="process" data-col="process" style="width: 200px;">
                <span class="th-content">
                  <span class="th-text">Process</span>
                  <span class="sort-indicator">⇅</span>
                </span>
                <div class="resize-handle"></div>
              </th>
              <th class="col-action" style="width: 100px; min-width: 100px;">Action</th>
            </tr>
          </thead>
          <tbody id="allPortsList">
            <!-- Empty state will be injected here -->
          </tbody>
        </table>
      </div>
      
      <!-- Empty State -->
      <div class="empty-state" id="emptyState" style="display: none;">
        <div class="empty-state-content">
          <svg class="empty-state-icon" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
          <h3 class="empty-state-title">No ports found</h3>
          <p class="empty-state-message" id="emptyStateMessage">No active ports match your search criteria.</p>
          <button id="clearFiltersBtn" class="btn-secondary" style="display: none;">
            Clear filters
          </button>
        </div>
      </div>
      
      <!-- Loading Skeleton -->
      <div class="skeleton-container" id="skeletonLoader" style="display: none;">
        <div class="skeleton-row">
          <div class="skeleton skeleton-port"></div>
          <div class="skeleton skeleton-pid"></div>
          <div class="skeleton skeleton-cpu"></div>
          <div class="skeleton skeleton-memory"></div>
          <div class="skeleton skeleton-user"></div>
          <div class="skeleton skeleton-process"></div>
          <div class="skeleton skeleton-action"></div>
        </div>
        <div class="skeleton-row">
          <div class="skeleton skeleton-port"></div>
          <div class="skeleton skeleton-pid"></div>
          <div class="skeleton skeleton-cpu"></div>
          <div class="skeleton skeleton-memory"></div>
          <div class="skeleton skeleton-user"></div>
          <div class="skeleton skeleton-process"></div>
          <div class="skeleton skeleton-action"></div>
        </div>
        <div class="skeleton-row">
          <div class="skeleton skeleton-port"></div>
          <div class="skeleton skeleton-pid"></div>
          <div class="skeleton skeleton-cpu"></div>
          <div class="skeleton skeleton-memory"></div>
          <div class="skeleton skeleton-user"></div>
          <div class="skeleton skeleton-process"></div>
          <div class="skeleton skeleton-action"></div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Status Bar Footer -->
  <footer class="status-bar">
    <div class="status-left">
      <span class="status-item" id="trayStatus">
        <svg class="status-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
          <line x1="8" y1="21" x2="16" y2="21"></line>
          <line x1="12" y1="17" x2="12" y2="21"></line>
        </svg>
        Running in tray
      </span>
      <span class="status-separator">•</span>
      <span class="status-item keyboard-hint">
        <kbd>⌘</kbd>+<kbd>K</kbd> Quick actions
      </span>
    </div>
    
    <div class="status-right">
      <span class="status-item" id="versionInfo">
        PortCleaner v1.0.0
      </span>
    </div>
  </footer>
  
  <!-- Toast Notification Container -->
  <div id="toastContainer" class="toast-container"></div>
  
  <!-- Context Menu -->
  <div id="contextMenu" class="context-menu hidden">
    <div class="menu-item" data-action="inspect">
      <span class="menu-icon">🔍</span>
      <span class="menu-text">Inspect Process</span>
    </div>
    <div class="menu-item" data-action="copy-info">
      <span class="menu-icon">📋</span>
      <span class="menu-text">Copy Info</span>
    </div>
    <div class="menu-divider"></div>
    <div class="menu-item danger" data-action="force-kill">
      <span class="menu-icon">⚠️</span>
      <span class="menu-text">Force Kill...</span>
    </div>
  </div>
  
  <!-- Protection Explanation Tooltip -->
  <div id="protectionTooltip" class="protection-tooltip hidden">
    <div class="tooltip-arrow"></div>
    <div class="tooltip-content">
      <h4 class="tooltip-title">🔒 Protected Process</h4>
      <p class="tooltip-message"></p>
      <div class="tooltip-reasons"></div>
    </div>
  </div>
  
  <!-- Process Inspect Modal -->
  <div id="inspectModal" class="modal-backdrop hidden">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Process Details</h3>
        <button class="modal-close" aria-label="Close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="inspect-grid">
          <div class="inspect-section">
            <h4>Basic Information</h4>
            <div class="inspect-field">
              <span class="inspect-label">Process Name:</span>
              <span class="inspect-value" id="inspectProcessName">-</span>
            </div>
            <div class="inspect-field">
              <span class="inspect-label">Process ID (PID):</span>
              <span class="inspect-value" id="inspectPid">-</span>
            </div>
            <div class="inspect-field">
              <span class="inspect-label">Port:</span>
              <span class="inspect-value" id="inspectPort">-</span>
            </div>
            <div class="inspect-field">
              <span class="inspect-label">User:</span>
              <span class="inspect-value" id="inspectUser">-</span>
            </div>
          </div>
          
          <div class="inspect-section">
            <h4>Resource Usage</h4>
            <div class="inspect-field">
              <span class="inspect-label">CPU Usage:</span>
              <span class="inspect-value" id="inspectCpu">-</span>
            </div>
            <div class="inspect-field">
              <span class="inspect-label">Memory Usage:</span>
              <span class="inspect-value" id="inspectMemory">-</span>
            </div>
          </div>
          
          <div class="inspect-section">
            <h4>Status</h4>
            <div class="inspect-field">
              <span class="inspect-label">Protection Status:</span>
              <span class="inspect-value" id="inspectProtection">-</span>
            </div>
            <div class="inspect-field">
              <span class="inspect-label">Port Type:</span>
              <span class="inspect-value" id="inspectPortType">-</span>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" id="copyProcessInfo">Copy Info</button>
        <button class="btn-primary" id="closeInspectModal">Close</button>
      </div>
    </div>
  </div>
  
  <script src="renderer.js"></script>
</body>
</html>